<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOCGODAI - í•™ìŠµ í”Œë«í¼ ë°ëª¨</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-right: 10px;
        }

        .status-pending {
            background: #ffc107;
            color: #000;
        }

        .status-completed {
            background: #28a745;
            color: white;
        }

        .status-processing {
            background: #17a2b8;
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .socket-events {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .socket-event {
            padding: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
            background: white;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .socket-event .time {
            color: #6c757d;
            font-size: 0.85em;
        }

        .socket-event .event-name {
            font-weight: 600;
            color: #667eea;
            margin-right: 10px;
        }

        .learning-content {
            margin-top: 15px;
        }

        .learning-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .learning-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .learning-section p {
            line-height: 1.6;
            color: #333;
        }

        .quiz-options {
            margin-top: 15px;
        }

        .quiz-option {
            display: block;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .quiz-option input {
            margin-right: 10px;
        }

        .quiz-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }

        .quiz-result.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .quiz-result.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .hidden {
            display: none;
        }

        .user-info {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chapter-list {
            list-style: none;
            margin-top: 15px;
        }

        .chapter-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #667eea;
        }

        .chapter-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .chapter-item .title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .chapter-item .meta {
            font-size: 0.9em;
            color: #6c757d;
        }

        .socket-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .socket-connected {
            background: #28a745;
            box-shadow: 0 0 8px #28a745;
        }

        .socket-disconnected {
            background: #dc3545;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ DOCGODAI</h1>
            <p>AI ê¸°ë°˜ ë§ì¶¤í˜• í•™ìŠµ í”Œë«í¼</p>
        </div>

        <!-- User Info -->
        <div id="userInfo" class="user-info hidden">
            <div>
                <strong>ë¡œê·¸ì¸:</strong> <span id="userEmail"></span>
                <span class="socket-status" id="socketStatus"></span>
                <span id="socketStatusText">ì—°ê²° ì¤‘...</span>
            </div>
            <button class="btn btn-secondary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <!-- Auth Section -->
        <div id="authSection" class="card">
            <h2>ğŸ” íšŒì›ê°€ì… / ë¡œê·¸ì¸</h2>

            <div class="grid">
                <div>
                    <h3>íšŒì›ê°€ì…</h3>
                    <div class="form-group">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="signupEmail" placeholder="student@example.com">
                    </div>
                    <div class="form-group">
                        <label>ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="signupPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                    </div>
                    <button class="btn" onclick="signup()">íšŒì›ê°€ì…</button>
                </div>

                <div>
                    <h3>ë¡œê·¸ì¸</h3>
                    <div class="form-group">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="loginEmail" placeholder="student@example.com">
                    </div>
                    <div class="form-group">
                        <label>ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                    </div>
                    <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
                </div>
            </div>
        </div>

        <!-- Question Section -->
        <div id="questionSection" class="card hidden">
            <h2>â“ ì§ˆë¬¸í•˜ê¸°</h2>
            <div class="form-group">
                <label>ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”</label>
                <textarea id="questionTitle" placeholder="ì˜ˆ: íŒŒì´ì¬ ë¦¬ìŠ¤íŠ¸ì™€ íŠœí”Œ ì°¨ì´ê°€ ë­ì˜ˆìš”?"></textarea>
            </div>
            <div class="form-group">
                <label>ì¶”ê°€ ì„¤ëª… (ì„ íƒ)</label>
                <textarea id="questionDesc" placeholder="ë” ìì„¸íˆ ì•Œê³  ì‹¶ì€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <button class="btn" onclick="createChapter()">ì§ˆë¬¸ ë“±ë¡</button>
        </div>

        <!-- Socket Events -->
        <div id="socketSection" class="card hidden">
            <h2>
                ğŸ“¡ ì‹¤ì‹œê°„ ì²˜ë¦¬ í˜„í™©
                <span class="socket-status" id="socketStatusIcon"></span>
            </h2>
            <div class="socket-events" id="socketEvents">
                <p style="color: #6c757d; text-align: center;">Socket.IO ì´ë²¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
            </div>
        </div>

        <!-- Chapters List -->
        <div id="chaptersSection" class="card hidden">
            <h2>ğŸ“š ë‚´ ì§ˆë¬¸ ëª©ë¡</h2>
            <button class="btn" onclick="loadChapters()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
            <ul class="chapter-list" id="chaptersList"></ul>
        </div>

        <!-- Learning Page -->
        <div id="learningSection" class="card hidden">
            <h2>
                ğŸ“– í•™ìŠµ í˜ì´ì§€
                <span id="chapterStatus"></span>
            </h2>

            <div id="learningContent">
                <div class="learning-section">
                    <h3>ğŸ“ ê°œë… ì •ë¦¬</h3>
                    <div id="conceptContent">
                        <p style="color: #6c757d;">AIê°€ ê°œë…ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>
                    </div>
                </div>

                <div class="learning-section">
                    <h3>ğŸ’» ì‹¤ìŠµ ê³¼ì œ</h3>
                    <div id="exerciseContent">
                        <p style="color: #6c757d;">AIê°€ ì‹¤ìŠµ ê³¼ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>
                    </div>
                </div>

                <div class="learning-section">
                    <h3>âœ… í€´ì¦ˆ</h3>
                    <div id="quizContent">
                        <p style="color: #6c757d;">AIê°€ í€´ì¦ˆë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let state = {
            token: null,
            userId: null,
            userEmail: null,
            currentChapterId: null,
            socket: null
        };

        const API_BASE = 'http://localhost:8000';

        // Initialize
        window.onload = () => {
            addSocketEvent('ì‹œìŠ¤í…œ', 'í˜ì´ì§€ ë¡œë“œë¨');
        };

        // Socket.IO connection
        function connectSocket() {
            state.socket = io(API_BASE);

            state.socket.on('connect', () => {
                addSocketEvent('ì—°ê²°', 'Socket.IO ì„œë²„ ì—°ê²° ì„±ê³µ');
                updateSocketStatus(true);
            });

            state.socket.on('disconnect', () => {
                addSocketEvent('ì—°ê²°', 'Socket.IO ì„œë²„ ì—°ê²° ëŠê¹€');
                updateSocketStatus(false);
            });

            state.socket.on('chapter_processing_started', (data) => {
                addSocketEvent('chapter_processing_started', `ì±•í„° ìƒì„± ì‹œì‘: ${data.title}`);
            });

            state.socket.on('concept_processing', (data) => {
                addSocketEvent('concept_processing', `ê°œë… ì •ë¦¬ AI ìƒì„± ì¤‘... (concept_id: ${data.concept_id})`);
            });

            state.socket.on('concept_completed', (data) => {
                addSocketEvent('concept_completed', `âœ… ê°œë… ì •ë¦¬ ì™„ë£Œ!`);
                if (state.currentChapterId === data.chapter_id) {
                    loadLearningPage(data.chapter_id);
                }
            });

            state.socket.on('exercise_processing', (data) => {
                addSocketEvent('exercise_processing', `ì‹¤ìŠµ ê³¼ì œ AI ìƒì„± ì¤‘... (exercise_id: ${data.exercise_id})`);
            });

            state.socket.on('exercise_completed', (data) => {
                addSocketEvent('exercise_completed', `âœ… ì‹¤ìŠµ ê³¼ì œ ì™„ë£Œ!`);
                if (state.currentChapterId === data.chapter_id) {
                    loadLearningPage(data.chapter_id);
                }
            });

            state.socket.on('quiz_processing', (data) => {
                addSocketEvent('quiz_processing', `í€´ì¦ˆ AI ìƒì„± ì¤‘... (quiz_num: ${data.quiz_num})`);
            });

            state.socket.on('quiz_completed', (data) => {
                addSocketEvent('quiz_completed', `âœ… í€´ì¦ˆ ì™„ë£Œ!`);
                if (state.currentChapterId === data.chapter_id) {
                    loadLearningPage(data.chapter_id);
                }
            });

            state.socket.on('all_completed', (data) => {
                addSocketEvent('all_completed', `ğŸ‰ ëª¨ë“  ì½˜í…ì¸  ìƒì„± ì™„ë£Œ!`);
                if (state.currentChapterId === data.chapter_id) {
                    loadLearningPage(data.chapter_id);
                }
            });
        }

        function updateSocketStatus(connected) {
            const statusIcon = document.getElementById('socketStatusIcon');
            const statusText = document.getElementById('socketStatusText');
            const statusDot = document.getElementById('socketStatus');

            if (connected) {
                statusIcon.className = 'socket-status socket-connected';
                statusDot.className = 'socket-status socket-connected';
                statusText.textContent = 'ì—°ê²°ë¨';
            } else {
                statusIcon.className = 'socket-status socket-disconnected';
                statusDot.className = 'socket-status socket-disconnected';
                statusText.textContent = 'ì—°ê²° ëŠê¹€';
            }
        }

        function joinChapterRoom(chapterId) {
            if (state.socket) {
                state.socket.emit('join_chapter', { chapter_id: chapterId });
                addSocketEvent('join_chapter', `ì±•í„° ë£¸ ì°¸ì—¬: ${chapterId}`);
            }
        }

        function addSocketEvent(eventName, message) {
            const eventsDiv = document.getElementById('socketEvents');
            const eventDiv = document.createElement('div');
            eventDiv.className = 'socket-event';

            const now = new Date().toLocaleTimeString();
            eventDiv.innerHTML = `
                <span class="time">[${now}]</span>
                <span class="event-name">${eventName}</span>
                <span>${message}</span>
            `;

            eventsDiv.insertBefore(eventDiv, eventsDiv.firstChild);

            // Keep only last 20 events
            while (eventsDiv.children.length > 20) {
                eventsDiv.removeChild(eventsDiv.lastChild);
            }
        }

        // Auth functions
        async function signup() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/v1/member/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    alert('íšŒì›ê°€ì… ì„±ê³µ! ì´ì œ ë¡œê·¸ì¸í•˜ì„¸ìš”.');
                    document.getElementById('signupEmail').value = '';
                    document.getElementById('signupPassword').value = '';
                } else {
                    alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${data.detail}`);
                }
            } catch (error) {
                alert(`ì—ëŸ¬ ë°œìƒ: ${error.message}`);
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/v1/member/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    state.token = data.access_token;
                    state.userId = data.member.id;
                    state.userEmail = data.member.email;

                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('userInfo').classList.remove('hidden');
                    document.getElementById('questionSection').classList.remove('hidden');
                    document.getElementById('socketSection').classList.remove('hidden');
                    document.getElementById('chaptersSection').classList.remove('hidden');
                    document.getElementById('userEmail').textContent = state.userEmail;

                    // Socket.IO ì—°ê²°
                    connectSocket();

                    // ì±•í„° ëª©ë¡ ë¡œë“œ
                    loadChapters();

                    addSocketEvent('ë¡œê·¸ì¸', `${state.userEmail} ë¡œê·¸ì¸ ì„±ê³µ`);
                } else {
                    alert(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${data.detail}`);
                }
            } catch (error) {
                alert(`ì—ëŸ¬ ë°œìƒ: ${error.message}`);
            }
        }

        async function logout() {
            if (state.socket) {
                state.socket.disconnect();
            }

            state.token = null;
            state.userId = null;
            state.userEmail = null;
            state.currentChapterId = null;

            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('questionSection').classList.add('hidden');
            document.getElementById('socketSection').classList.add('hidden');
            document.getElementById('chaptersSection').classList.add('hidden');
            document.getElementById('learningSection').classList.add('hidden');

            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // Chapter functions
        async function createChapter() {
            const title = document.getElementById('questionTitle').value;
            const description = document.getElementById('questionDesc').value;

            if (!title) {
                alert('ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/v1/chapter/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title,
                        description,
                        owner_id: state.userId
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    addSocketEvent('ì±•í„° ìƒì„±', `ì§ˆë¬¸ ë“±ë¡ ì™„ë£Œ: ${title}`);
                    alert(`ì§ˆë¬¸ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\nChapter ID: ${data.chapter_id}\n\nAIê°€ ì½˜í…ì¸ ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì‹œê°„ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.`);

                    // Clear form
                    document.getElementById('questionTitle').value = '';
                    document.getElementById('questionDesc').value = '';

                    // Join socket room
                    joinChapterRoom(data.chapter_id);

                    // Load learning page
                    state.currentChapterId = data.chapter_id;
                    loadLearningPage(data.chapter_id);

                    // Reload chapters list
                    loadChapters();
                } else {
                    alert(`ì§ˆë¬¸ ë“±ë¡ ì‹¤íŒ¨: ${data.detail}`);
                }
            } catch (error) {
                alert(`ì—ëŸ¬ ë°œìƒ: ${error.message}`);
            }
        }

        async function loadChapters() {
            try {
                const response = await fetch(`${API_BASE}/v1/chapter/?owner_id=${state.userId}`);
                const chapters = await response.json();

                const listDiv = document.getElementById('chaptersList');
                listDiv.innerHTML = '';

                if (chapters.length === 0) {
                    listDiv.innerHTML = '<p style="color: #6c757d; text-align: center; padding: 20px;">ì•„ì§ ë“±ë¡í•œ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                    return;
                }

                chapters.forEach(chapter => {
                    const item = document.createElement('li');
                    item.className = 'chapter-item';
                    item.onclick = () => {
                        state.currentChapterId = chapter.id;
                        joinChapterRoom(chapter.id);
                        loadLearningPage(chapter.id);
                    };

                    const statusClass = chapter.status === 'completed' ? 'status-completed' : 'status-pending';
                    const statusText = chapter.status === 'completed' ? 'ì™„ë£Œ' : 'ìƒì„± ì¤‘';

                    item.innerHTML = `
                        <div class="title">${chapter.title}</div>
                        <div class="meta">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                            <span>ìƒì„±ì¼: ${new Date(chapter.created_at).toLocaleString()}</span>
                        </div>
                    `;

                    listDiv.appendChild(item);
                });
            } catch (error) {
                alert(`ì±•í„° ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
            }
        }

        async function loadLearningPage(chapterId) {
            try {
                const response = await fetch(`${API_BASE}/v1/chapter/${chapterId}/learning`);
                const data = await response.json();

                if (response.ok) {
                    document.getElementById('learningSection').classList.remove('hidden');

                    // Update status badge
                    const statusClass = data.status === 'completed' ? 'status-completed' : 'status-processing';
                    const statusText = data.status === 'completed' ? 'ì™„ë£Œ' : 'AI ìƒì„± ì¤‘';
                    document.getElementById('chapterStatus').innerHTML = `<span class="status-badge ${statusClass}">${statusText}</span>`;

                    // Update concept
                    const conceptDiv = document.getElementById('conceptContent');
                    if (data.concept && data.concept.is_complete) {
                        conceptDiv.innerHTML = `
                            <h4>${data.concept.title}</h4>
                            <p>${data.concept.content}</p>
                        `;
                    } else {
                        conceptDiv.innerHTML = '<p style="color: #6c757d;">AIê°€ ê°œë…ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>';
                    }

                    // Update exercise
                    const exerciseDiv = document.getElementById('exerciseContent');
                    if (data.exercise && data.exercise.is_complete) {
                        exerciseDiv.innerHTML = `<p><strong>ë¬¸ì œ:</strong> ${data.exercise.question}</p>`;
                    } else {
                        exerciseDiv.innerHTML = '<p style="color: #6c757d;">AIê°€ ì‹¤ìŠµ ê³¼ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>';
                    }

                    // Update quiz
                    const quizDiv = document.getElementById('quizContent');
                    if (data.quiz && data.quiz.question) {
                        let optionsHtml = '';
                        if (data.quiz.options && Array.isArray(data.quiz.options)) {
                            optionsHtml = data.quiz.options.map((opt, idx) => `
                                <label class="quiz-option">
                                    <input type="radio" name="quizAnswer" value="${opt}">
                                    ${opt}
                                </label>
                            `).join('');
                        }

                        quizDiv.innerHTML = `
                            <p><strong>${data.quiz.question}</strong></p>
                            <div class="quiz-options">
                                ${optionsHtml}
                            </div>
                            <button class="btn" onclick="submitQuiz(${chapterId}, ${data.quiz.id})" style="margin-top: 15px;">ì •ë‹µ ì œì¶œ</button>
                            <div id="quizResult"></div>
                        `;
                    } else {
                        quizDiv.innerHTML = '<p style="color: #6c757d;">AIê°€ í€´ì¦ˆë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p>';
                    }

                    addSocketEvent('í•™ìŠµ í˜ì´ì§€', `ì±•í„° ${chapterId} ë¡œë“œë¨`);
                } else {
                    alert(`í•™ìŠµ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨: ${data.detail}`);
                }
            } catch (error) {
                alert(`ì—ëŸ¬ ë°œìƒ: ${error.message}`);
            }
        }

        async function submitQuiz(chapterId, quizId) {
            const selectedAnswer = document.querySelector('input[name="quizAnswer"]:checked');

            if (!selectedAnswer) {
                alert('ë‹µì„ ì„ íƒí•˜ì„¸ìš”');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/v1/quiz/${chapterId}/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        answer: selectedAnswer.value,
                        member_id: state.userId
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    const resultDiv = document.getElementById('quizResult');
                    const resultClass = data.is_correct ? 'correct' : 'incorrect';
                    const resultText = data.is_correct ? 'ì •ë‹µì…ë‹ˆë‹¤!' : 'ì˜¤ë‹µì…ë‹ˆë‹¤.';

                    resultDiv.className = `quiz-result ${resultClass}`;
                    resultDiv.innerHTML = `
                        ${resultText} (ì ìˆ˜: ${data.score}ì )
                        ${data.explanation ? `<br><br>${data.explanation}` : ''}
                    `;

                    addSocketEvent('í€´ì¦ˆ ì œì¶œ', `ê²°ê³¼: ${resultText}`);
                } else {
                    alert(`í€´ì¦ˆ ì œì¶œ ì‹¤íŒ¨: ${data.detail}`);
                }
            } catch (error) {
                alert(`ì—ëŸ¬ ë°œìƒ: ${error.message}`);
            }
        }
    </script>
</body>
</html>
