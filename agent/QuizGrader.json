{
  "name": "106-2. QuizGrader",
  "nodes": [
    {
      "parameters": {
        "multipleMethods": true,
        "httpMethod": [
          "POST"
        ],
        "path": "grade1",
        "responseMode": "responseNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "607ece6c-3f33-4899-b7be-cd07a7287ffe",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        240,
        -96
      ],
      "webhookId": "19a51d5d-bffc-4238-9c73-f40933d463d7",
      "retryOnFail": false,
      "typeVersion": 2.1,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e2e66220-73f7-4ecd-bc66-430ed4697083",
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        240,
        160
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "o1pUX0sSSunBHGtz",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "c651debc-45e3-4222-99e9-ddf40eb244da",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        1008,
        -96
      ],
      "typeVersion": 1.4
    },
    {
      "parameters": {
        "jsCode": "// 1. ì…ë ¥ ê°€ì ¸ì˜¤ê¸°\nlet raw = $input.first().json.output;\n\n// 2. ì½”ë“œë¸”ë¡( ```json ... ``` ) ì œê±°\nif (typeof raw === \"string\") {\n  raw = raw.replace(/```json\\s*/g, \"\").replace(/```/g, \"\").trim();\n}\n\n// 3. ë¬¸ìì—´ì„ JSONìœ¼ë¡œ íŒŒì‹±\nlet parsed;\ntry {\n  parsed = JSON.parse(raw);\n} catch (e) {\n  parsed = { quizes: [] };\n}\n\n// 4. ê²°ê³¼ ë°˜í™˜ (ë¶ˆí•„ìš”í•œ wrapping ì—†ì´)\nreturn parsed;\n"
      },
      "id": "e1397f19-8f4c-4971-8db6-1c31f451c3bc",
      "name": "Code in JavaScript",
      "type": "n8n-nodes-base.code",
      "position": [
        816,
        -96
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=={{\n\"ğŸ“˜ Course Title: \" + $json.body.output.courseTitle + \"\\n\" +\n\"ğŸ“ Course Description: \" + $json.body.output.courseDescription + \"\\n\\n\" +\n\"ğŸ“š Contents:\\n\" +\n$json.body.output.contents.map((c, i) => (\n  \"  [\" + (i + 1) + \"] Quiz: \" + c.quiz + \"\\n\" +\n  \"      Answer: \" + c.answer\n)).join(\"\\n\\n\") +\n\"\\n\\nâœ… End of Summary\\n\"\n}}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "ë‹¹ì‹ ì€ JSON ì‘ë‹µ ì „ìš© AIì…ë‹ˆë‹¤.\n\nì…ë ¥ ë°ì´í„°ëŠ” ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì£¼ì–´ì§‘ë‹ˆë‹¤:\n\n{\n  \"output\": {\n    \"courseTitle\": \"Python ê¸°ì´ˆ í…ŒìŠ¤íŠ¸\",\n    \"courseDescription\": \"ìë£Œí˜•, ì¡°ê±´ë¬¸, ë°˜ë³µë¬¸ ì¤‘ì‹¬ í‰ê°€\",\n    \"contents\": [\n      {\"quiz\": \"íŒŒì´ì¬ì—ì„œ ë¦¬ìŠ¤íŠ¸ì˜ ê¸¸ì´ë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜ëŠ”?\", \"answer\": \"len()\"},\n      {\"quiz\": \"ë°˜ë³µë¬¸ì„ íƒˆì¶œí•˜ëŠ” í‚¤ì›Œë“œëŠ”?\", \"answer\": \"continue\"},\n      {\"quiz\": \"if ë¬¸ì˜ ì¡°ê±´ì´ ê±°ì§“ì´ë©´ else ì ˆì´ ì‹¤í–‰ëœë‹¤. (O/X)\", \"answer\": \"O\"}\n    ]\n  }\n}\n\nì‘ì—…:\n\nYou are an expert AI grader, meticulously evaluating student answers against provided quizzes within the context of a course. Your task is to process the `content`, extract relevant information, and for each content item, calculate a 'score' (e.g., 'correct', 'incorrect', or a percentage) for the student's 'answer' to the 'quiz'. You must also determine the 'correct_answer' for each quiz. The output should be a list of JSON objects, each containing the 'id', 'score', and 'correct_answer' for a content item.\n# Step by Step instructions\n1. Parse the Course Data Json to extract the 'courseTitle', 'courseDescription', and the list of 'contents'.\n2. For each 'content' object in the 'contents' list:\n    a. Extract the 'id', 'quiz', and 'answer' from the 'content' object.\n    b. Evaluate the 'answer' against the 'quiz' within the context of the 'courseTitle' and 'courseDescription'.\n    c. Calculate a 'score' for the answer (e.g., 'correct', 'incorrect', or a percentage).\n    d. Determine the 'correct_answer' for the quiz.\n    e. Create a JSON object with the 'id', 'score', and 'correct_answer'.\n    f. Add this JSON object to a list of score objects.\n3. Once all 'content' objects have been processed, output the complete list of score objects as a JSON array.\n\n\n\n\n\nì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ JSON):\n{\n \"scores\" : [\n { \"id\" : \"number\", \"score\" : \"number\" \"correct_answer\" : \"string\" }, \n{ \"id\" : \"number\", \"score\" : \"number\" \"correct_answer\" : \"string\" }, \n{ \"id\" : \"number\", \"score\" : \"number\" \"correct_answer\" : \"string\" } \n]\n}\n\nâš ï¸ ê·œì¹™:\n- ë°˜ë“œì‹œ ìœ„ JSON êµ¬ì¡°ë§Œ ì¶œë ¥í•˜ì„¸ìš”.\n- ì ˆëŒ€ë¡œ {\"output\": {...}} ë˜ëŠ” ë¬¸ìì—´(JSON string) í˜•íƒœë¡œ ê°ì‹¸ì§€ ë§ˆì„¸ìš”.\n- ëŒ€í™”í˜• ë©˜íŠ¸, ì„¤ëª…, ì‚¬ì¡± ì—†ì´ ì˜¤ì§ JSON ë°ì´í„°ë§Œ ì¶œë ¥í•˜ì„¸ìš”.\n- \"contents\" í•„ë“œëŠ” markdown ë¬¸ì„œ ë³¸ë¬¸ìœ¼ë¡œ ì±„ìš°ì„¸ìš” .\nâš ï¸ ì¶œë ¥ ì‹œ ì ˆëŒ€ë¡œ Markdown ì½”ë“œë¸”ë¡(````json`, ``` ë“±)ì„ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.\nâš ï¸ ì ˆëŒ€ë¡œ {\"output\": {...}} í˜•íƒœë¡œ ê°ì‹¸ì§€ ë§ê³ , \nì˜¤ì§ {\"title\": \"...\", \"description\": \"...\", \"contents\": \"...\"} êµ¬ì¡°ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”.\n"
        }
      },
      "id": "c247e314-5962-4329-818b-188da1077c2d",
      "name": "QuizGrader",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        448,
        -96
      ],
      "typeVersion": 3,
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "QuizGrader",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "QuizGrader": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook": {
      "main": [
        []
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "QuizGrader",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "af529730-0b76-40e0-bcf2-e2aa4943c19a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "80eb4af7e1f0a6b1250e1e59a96c1b5d5d7138f42a94f997f80629b587ebbfc8"
  },
  "id": "4iLABMvaKckiB0nd",
  "tags": []
}